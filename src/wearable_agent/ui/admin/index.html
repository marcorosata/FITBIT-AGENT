<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wearable Agent â€” Admin Dashboard</title>
<style>
:root {
  --bg: #0f1117;
  --surface: #1a1d27;
  --surface2: #242736;
  --border: #2e3245;
  --text: #e4e6f0;
  --text2: #8b8fa3;
  --accent: #6c5ce7;
  --accent-light: #a29bfe;
  --success: #00b894;
  --warning: #fdcb6e;
  --danger: #e17055;
  --critical: #d63031;
  --info: #74b9ff;
  --radius: 12px;
  --shadow: 0 4px 24px rgba(0,0,0,0.3);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
}
a { color: var(--accent-light); text-decoration: none; }
a:hover { text-decoration: underline; }

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 2rem;
  display: flex;
  align-items: center;
  height: 60px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.topbar h1 {
  font-size: 1.15rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: .5rem;
}
.topbar h1 span { color: var(--accent-light); }
.topbar .status {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: .5rem;
  font-size: .85rem;
  color: var(--text2);
}
.topbar .dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--success);
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: .4; }
}

.shell {
  display: grid;
  grid-template-columns: 220px 1fr;
  min-height: calc(100vh - 60px);
}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  background: var(--surface);
  border-right: 1px solid var(--border);
  padding: 1.5rem 0;
}
.sidebar .nav-item {
  display: flex;
  align-items: center;
  gap: .6rem;
  padding: .65rem 1.5rem;
  font-size: .9rem;
  color: var(--text2);
  cursor: pointer;
  transition: all .15s;
  border-left: 3px solid transparent;
}
.sidebar .nav-item:hover { color: var(--text); background: var(--surface2); }
.sidebar .nav-item.active {
  color: var(--accent-light);
  background: rgba(108,92,231,.08);
  border-left-color: var(--accent);
}
.sidebar .nav-label {
  padding: .5rem 1.5rem;
  font-size: .7rem;
  text-transform: uppercase;
  letter-spacing: .08em;
  color: var(--text2);
  margin-top: 1rem;
}

/* â”€â”€ Main content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main { padding: 2rem; overflow-y: auto; }
.page { display: none; }
.page.active { display: block; }
.page-title {
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
}

/* â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}
.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.25rem;
}
.stat-card .label { font-size: .8rem; color: var(--text2); margin-bottom: .25rem; }
.stat-card .number { font-size: 1.8rem; font-weight: 700; }
.stat-card .sub { font-size: .75rem; color: var(--text2); margin-top: .25rem; }

.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}
.card-title {
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: .5rem;
}

/* â”€â”€ Tables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
table {
  width: 100%;
  border-collapse: collapse;
  font-size: .85rem;
}
th {
  text-align: left;
  padding: .6rem .75rem;
  font-weight: 600;
  color: var(--text2);
  border-bottom: 1px solid var(--border);
  font-size: .75rem;
  text-transform: uppercase;
  letter-spacing: .04em;
}
td {
  padding: .6rem .75rem;
  border-bottom: 1px solid var(--border);
}
tr:hover { background: var(--surface2); }

/* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  display: inline-block;
  padding: .15rem .55rem;
  border-radius: 999px;
  font-size: .72rem;
  font-weight: 600;
  text-transform: uppercase;
}
.badge-info { background: rgba(116,185,255,.15); color: var(--info); }
.badge-warning { background: rgba(253,203,110,.15); color: var(--warning); }
.badge-critical { background: rgba(214,48,49,.15); color: var(--critical); }

/* â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
}
.form-group { display: flex; flex-direction: column; gap: .3rem; }
.form-group label { font-size: .8rem; color: var(--text2); }
input, select, textarea {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: .55rem .75rem;
  color: var(--text);
  font-size: .88rem;
  font-family: inherit;
  outline: none;
  transition: border .15s;
}
input:focus, select:focus, textarea:focus { border-color: var(--accent); }
textarea { resize: vertical; min-height: 80px; }

.btn {
  display: inline-flex;
  align-items: center;
  gap: .4rem;
  padding: .55rem 1.2rem;
  border: none;
  border-radius: 8px;
  font-size: .85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all .15s;
  font-family: inherit;
}
.btn-primary { background: var(--accent); color: #fff; }
.btn-primary:hover { background: #5b4bd5; }
.btn-danger { background: var(--danger); color: #fff; }
.btn-danger:hover { background: #c0392b; }
.btn-sm { padding: .35rem .75rem; font-size: .78rem; }
.btn-outline {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text2);
}
.btn-outline:hover { border-color: var(--accent); color: var(--accent-light); }

/* â”€â”€ Agent chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chat-box {
  background: var(--surface2);
  border-radius: var(--radius);
  padding: 1.25rem;
  max-height: 400px;
  overflow-y: auto;
  margin-bottom: 1rem;
  font-size: .88rem;
  white-space: pre-wrap;
  line-height: 1.7;
}
.chat-input-row {
  display: flex;
  gap: .75rem;
}
.chat-input-row input { flex: 1; }

/* â”€â”€ Live log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#live-log {
  background: #0d0f14;
  border-radius: var(--radius);
  padding: 1rem;
  font-family: 'Cascadia Code', 'Fira Code', monospace;
  font-size: .78rem;
  max-height: 350px;
  overflow-y: auto;
  line-height: 1.8;
}
.log-entry { border-bottom: 1px solid rgba(255,255,255,.04); padding: .2rem 0; }
.log-ts { color: var(--text2); }
.log-level-info { color: var(--info); }
.log-level-warning { color: var(--warning); }
.log-level-critical { color: var(--critical); }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 768px) {
  .shell { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .stats-row { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body>

<!-- â”€â”€ Top bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="topbar">
  <h1>ğŸ©º <span>Wearable Agent</span> â€” Admin</h1>
  <div class="status">
    <div class="dot" id="status-dot"></div>
    <span id="status-text">Connectingâ€¦</span>
  </div>
</div>

<div class="shell">

<!-- â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav class="sidebar">
  <div class="nav-label">Overview</div>
  <div class="nav-item active" data-page="dashboard">ğŸ“Š Dashboard</div>
  <div class="nav-item" data-page="readings">ğŸ“ˆ Readings</div>
  <div class="nav-item" data-page="alerts">ğŸ”” Alerts</div>
  <div class="nav-label">Management</div>
  <div class="nav-item" data-page="rules">âš™ï¸ Rules</div>
  <div class="nav-item" data-page="ingest">ğŸ“¥ Ingest Data</div>
  <div class="nav-item" data-page="participants">ğŸ‘¥ Participants</div>
  <div class="nav-label">Intelligence</div>
  <div class="nav-item" data-page="agent">ğŸ¤– Agent Chat</div>
  <div class="nav-item" data-page="live">ğŸ“¡ Live Feed</div>
</nav>

<!-- â”€â”€ Main content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="main">

  <!-- â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page active" id="page-dashboard">
    <div class="page-title">Dashboard</div>
    <div class="stats-row">
      <div class="stat-card">
        <div class="label">Total Readings</div>
        <div class="number" id="stat-readings">â€”</div>
        <div class="sub">all participants</div>
      </div>
      <div class="stat-card">
        <div class="label">Active Alerts</div>
        <div class="number" id="stat-alerts">â€”</div>
        <div class="sub">last 24 hours</div>
      </div>
      <div class="stat-card">
        <div class="label">Monitoring Rules</div>
        <div class="number" id="stat-rules">â€”</div>
        <div class="sub">active</div>
      </div>
      <div class="stat-card">
        <div class="label">Pipeline</div>
        <div class="number" id="stat-pipeline">â€”</div>
        <div class="sub">pending items</div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“‹ Recent Alerts</div>
      <table>
        <thead><tr><th>Time</th><th>Participant</th><th>Metric</th><th>Value</th><th>Severity</th><th>Message</th></tr></thead>
        <tbody id="dash-alerts-body"></tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ Readings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-readings">
    <div class="page-title">Sensor Readings</div>
    <div class="card">
      <div class="form-row">
        <div class="form-group">
          <label>Participant ID</label>
          <input id="rd-participant" value="P001" placeholder="e.g. P001">
        </div>
        <div class="form-group">
          <label>Metric</label>
          <select id="rd-metric">
            <option value="heart_rate">Heart Rate</option>
            <option value="steps">Steps</option>
            <option value="sleep">Sleep</option>
            <option value="spo2">SpO2</option>
            <option value="hrv">HRV</option>
          </select>
        </div>
        <div class="form-group">
          <label>Limit</label>
          <input id="rd-limit" type="number" value="50" min="1" max="1000">
        </div>
        <div class="form-group" style="justify-content:flex-end">
          <button class="btn btn-primary" onclick="loadReadings()">ğŸ” Query</button>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“ˆ Results</div>
      <div id="readings-stats" style="margin-bottom:1rem; font-size:.85rem; color:var(--text2)"></div>
      <div style="overflow-x:auto">
        <table>
          <thead><tr><th>Timestamp</th><th>Value</th><th>Unit</th><th>Device</th></tr></thead>
          <tbody id="readings-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Alerts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-alerts">
    <div class="page-title">Alerts</div>
    <div class="card">
      <div class="form-row">
        <div class="form-group">
          <label>Participant ID</label>
          <input id="al-participant" value="P001" placeholder="e.g. P001">
        </div>
        <div class="form-group" style="justify-content:flex-end">
          <button class="btn btn-primary" onclick="loadAlerts()">ğŸ” Load Alerts</button>
        </div>
      </div>
    </div>
    <div class="card">
      <table>
        <thead><tr><th>Time</th><th>Severity</th><th>Metric</th><th>Value</th><th>Message</th></tr></thead>
        <tbody id="alerts-body"></tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ Rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-rules">
    <div class="page-title">Monitoring Rules</div>
    <div class="card">
      <div class="card-title">â• Add New Rule</div>
      <div class="form-row">
        <div class="form-group">
          <label>Metric</label>
          <select id="rule-metric">
            <option value="heart_rate">Heart Rate</option>
            <option value="steps">Steps</option>
            <option value="sleep">Sleep</option>
            <option value="spo2">SpO2</option>
            <option value="hrv">HRV</option>
          </select>
        </div>
        <div class="form-group">
          <label>Condition</label>
          <input id="rule-condition" placeholder="e.g. value > 120">
        </div>
        <div class="form-group">
          <label>Severity</label>
          <select id="rule-severity">
            <option value="info">Info</option>
            <option value="warning" selected>Warning</option>
            <option value="critical">Critical</option>
          </select>
        </div>
      </div>
      <div class="form-group" style="margin-bottom:1rem">
        <label>Message Template</label>
        <input id="rule-message" placeholder="HR {value} bpm exceeded threshold." value="Metric {metric_type} value {value} breached rule.">
      </div>
      <button class="btn btn-primary" onclick="addRule()">Add Rule</button>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“ Active Rules</div>
      <table>
        <thead><tr><th>ID</th><th>Metric</th><th>Condition</th><th>Severity</th><th>Message</th><th>Action</th></tr></thead>
        <tbody id="rules-body"></tbody>
      </table>
    </div>
  </div>

  <!-- â”€â”€ Ingest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-ingest">
    <div class="page-title">Ingest Data</div>
    <div class="card">
      <div class="card-title">ğŸ“¥ Manual Data Entry</div>
      <div class="form-row">
        <div class="form-group">
          <label>Participant ID</label>
          <input id="ing-participant" value="P001">
        </div>
        <div class="form-group">
          <label>Device</label>
          <select id="ing-device">
            <option value="fitbit">Fitbit</option>
            <option value="apple_watch">Apple Watch</option>
            <option value="garmin">Garmin</option>
            <option value="generic">Generic</option>
          </select>
        </div>
        <div class="form-group">
          <label>Metric</label>
          <select id="ing-metric">
            <option value="heart_rate">Heart Rate</option>
            <option value="steps">Steps</option>
            <option value="sleep">Sleep</option>
            <option value="spo2">SpO2</option>
            <option value="hrv">HRV</option>
          </select>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Value</label>
          <input id="ing-value" type="number" step="0.1" placeholder="e.g. 72">
        </div>
        <div class="form-group">
          <label>Unit</label>
          <input id="ing-unit" value="bpm">
        </div>
        <div class="form-group" style="justify-content:flex-end">
          <button class="btn btn-primary" onclick="ingestData()">ğŸ“¤ Submit</button>
        </div>
      </div>
      <div id="ingest-result" style="margin-top:.75rem; font-size:.85rem;"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ“¦ Batch Ingest (JSON)</div>
      <textarea id="ing-batch" rows="6" placeholder='[{"participant_id":"P001","device_type":"fitbit","metric_type":"heart_rate","value":72,"unit":"bpm"}]'></textarea>
      <div style="margin-top:.75rem">
        <button class="btn btn-primary" onclick="ingestBatch()">ğŸ“¤ Submit Batch</button>
      </div>
      <div id="batch-result" style="margin-top:.75rem; font-size:.85rem;"></div>
    </div>
  </div>

  <!-- â”€â”€ Participants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-participants">
    <div class="page-title">Participants</div>
    <div class="card">
      <div class="card-title">ğŸ‘¥ Known Participants</div>
      <p style="color:var(--text2); font-size:.85rem; margin-bottom:1rem">
        Participants are discovered from ingested data. Use the evaluation below to inspect a participant.
      </p>
      <div id="participants-list"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”¬ Participant Evaluation</div>
      <div class="form-row">
        <div class="form-group">
          <label>Participant ID</label>
          <input id="eval-participant" value="P001">
        </div>
        <div class="form-group">
          <label>Metric</label>
          <select id="eval-metric">
            <option value="heart_rate">Heart Rate</option>
            <option value="steps">Steps</option>
          </select>
        </div>
        <div class="form-group">
          <label>Hours back</label>
          <input id="eval-hours" type="number" value="24" min="1" max="168">
        </div>
        <div class="form-group" style="justify-content:flex-end">
          <button class="btn btn-primary" onclick="evaluateParticipant()">ğŸ¤– Evaluate</button>
        </div>
      </div>
      <div id="eval-result" class="chat-box" style="display:none"></div>
    </div>
  </div>

  <!-- â”€â”€ Agent Chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-agent">
    <div class="page-title">Agent Chat</div>
    <div class="card">
      <div class="card-title">ğŸ¤– Ask the Agent</div>
      <p style="color:var(--text2); font-size:.85rem; margin-bottom:1rem">
        Send free-form research questions. The agent can query the database, compute statistics, and reason about anomalies.
      </p>
      <div class="chat-box" id="chat-messages">
        <em style="color:var(--text2)">No messages yet. Ask a question below.</em>
      </div>
      <div class="chat-input-row">
        <input id="chat-input" placeholder="e.g. Summarise P001's heart rate data for the last 24 hours" onkeydown="if(event.key==='Enter')sendChat()">
        <button class="btn btn-primary" onclick="sendChat()">Send</button>
      </div>
    </div>
  </div>

  <!-- â”€â”€ Live Feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="page" id="page-live">
    <div class="page-title">Live Feed</div>
    <div class="card">
      <div class="card-title">ğŸ“¡ Real-Time Event Log</div>
      <div id="live-log">
        <div class="log-entry"><span class="log-ts">--</span> Waiting for eventsâ€¦</div>
      </div>
    </div>
  </div>

</div><!-- .main -->
</div><!-- .shell -->

<script>
const API = '';  // Same origin

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    item.classList.add('active');
    document.getElementById('page-' + item.dataset.page).classList.add('active');
  });
});

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function api(method, path, body) {
  const opts = { method, headers: { 'Content-Type': 'application/json' } };
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch(API + path, opts);
  return r.json();
}

function fmtTime(iso) {
  const d = new Date(iso);
  return d.toLocaleString();
}

function severityBadge(s) {
  const cls = s === 'critical' ? 'badge-critical' : s === 'warning' ? 'badge-warning' : 'badge-info';
  return `<span class="badge ${cls}">${s}</span>`;
}

// â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function refreshDashboard() {
  try {
    const health = await api('GET', '/health');
    document.getElementById('stat-pipeline').textContent = health.pipeline_pending;
    document.getElementById('status-text').textContent = 'Online';
    document.getElementById('status-dot').style.background = 'var(--success)';
  } catch {
    document.getElementById('status-text').textContent = 'Offline';
    document.getElementById('status-dot').style.background = 'var(--danger)';
  }

  try {
    const rules = await api('GET', '/rules');
    document.getElementById('stat-rules').textContent = rules.length;
  } catch {}

  try {
    const stats = await api('GET', '/api/stats');
    document.getElementById('stat-readings').textContent = stats.total_readings.toLocaleString();
    document.getElementById('stat-alerts').textContent = stats.total_alerts.toLocaleString();

    // Show recent alerts on dashboard
    const html = stats.recent_alerts.map(a => `
      <tr>
        <td>${fmtTime(a.timestamp)}</td>
        <td>${a.participant_id}</td>
        <td>${a.metric}</td>
        <td>${a.value}</td>
        <td>${severityBadge(a.severity)}</td>
        <td style="max-width:300px; overflow:hidden; text-overflow:ellipsis">${a.message}</td>
      </tr>
    `).join('');
    document.getElementById('dash-alerts-body').innerHTML = html || '<tr><td colspan="6" style="color:var(--text2)">No recent alerts.</td></tr>';

    // Participants page
    if (stats.participants && stats.participants.length) {
      document.getElementById('participants-list').innerHTML = stats.participants.map(p =>
        `<span class="badge badge-info" style="margin:.25rem; cursor:pointer" onclick="document.getElementById('eval-participant').value='${p}'">${p}</span>`
      ).join('');
    }
  } catch {
    document.getElementById('stat-readings').textContent = 'â€”';
    document.getElementById('stat-alerts').textContent = 'â€”';
  }
}

// â”€â”€ Readings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadReadings() {
  const pid = document.getElementById('rd-participant').value;
  const metric = document.getElementById('rd-metric').value;
  const limit = document.getElementById('rd-limit').value;
  const data = await api('GET', `/readings/${pid}?metric=${metric}&limit=${limit}`);
  if (!data.length) {
    document.getElementById('readings-body').innerHTML = '<tr><td colspan="4" style="color:var(--text2)">No readings found.</td></tr>';
    document.getElementById('readings-stats').textContent = '';
    return;
  }
  const vals = data.map(r => r.value);
  const mean = (vals.reduce((a,b)=>a+b,0)/vals.length).toFixed(1);
  const min = Math.min(...vals).toFixed(1);
  const max = Math.max(...vals).toFixed(1);
  document.getElementById('readings-stats').textContent = `${data.length} readings â€” Mean: ${mean} | Min: ${min} | Max: ${max}`;
  document.getElementById('readings-body').innerHTML = data.map(r => `
    <tr><td>${fmtTime(r.timestamp)}</td><td><strong>${r.value}</strong></td><td>${r.unit}</td><td>${r.device_type}</td></tr>
  `).join('');
}

// â”€â”€ Alerts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAlerts() {
  const pid = document.getElementById('al-participant').value;
  const data = await api('GET', `/alerts/${pid}`);
  document.getElementById('alerts-body').innerHTML = data.length
    ? data.map(a => `
      <tr><td>${fmtTime(a.timestamp)}</td><td>${severityBadge(a.severity)}</td><td>${a.metric}</td><td>${a.value}</td><td>${a.message}</td></tr>
    `).join('')
    : '<tr><td colspan="5" style="color:var(--text2)">No alerts found.</td></tr>';
}

// â”€â”€ Rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadRules() {
  const data = await api('GET', '/rules');
  document.getElementById('rules-body').innerHTML = data.map(r => `
    <tr>
      <td style="font-family:monospace;font-size:.75rem">${r.rule_id.slice(0,8)}â€¦</td>
      <td>${r.metric_type}</td>
      <td><code style="background:var(--surface2);padding:.15rem .4rem;border-radius:4px">${r.condition}</code></td>
      <td>${severityBadge(r.severity)}</td>
      <td style="max-width:250px;overflow:hidden;text-overflow:ellipsis">${r.message_template}</td>
      <td><button class="btn btn-danger btn-sm" onclick="deleteRule('${r.rule_id}')">âœ•</button></td>
    </tr>`).join('');
}

async function addRule() {
  await api('POST', '/rules', {
    metric_type: document.getElementById('rule-metric').value,
    condition: document.getElementById('rule-condition').value,
    severity: document.getElementById('rule-severity').value,
    message_template: document.getElementById('rule-message').value,
  });
  document.getElementById('rule-condition').value = '';
  loadRules();
}

async function deleteRule(id) {
  await api('DELETE', `/rules/${id}`);
  loadRules();
}

// â”€â”€ Ingest â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function ingestData() {
  const res = await api('POST', '/ingest', {
    participant_id: document.getElementById('ing-participant').value,
    device_type: document.getElementById('ing-device').value,
    metric_type: document.getElementById('ing-metric').value,
    value: parseFloat(document.getElementById('ing-value').value),
    unit: document.getElementById('ing-unit').value,
  });
  document.getElementById('ingest-result').innerHTML = `<span style="color:var(--success)">âœ“ Queued â€” ID: ${res.id}</span>`;
  refreshDashboard();
}

async function ingestBatch() {
  try {
    const raw = JSON.parse(document.getElementById('ing-batch').value);
    const res = await api('POST', '/ingest/batch', raw);
    document.getElementById('batch-result').innerHTML = `<span style="color:var(--success)">âœ“ ${res.count} readings queued</span>`;
    refreshDashboard();
  } catch(e) {
    document.getElementById('batch-result').innerHTML = `<span style="color:var(--danger)">Error: ${e.message}</span>`;
  }
}

// â”€â”€ Agent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let chatHist = [];
async function sendChat() {
  const input = document.getElementById('chat-input');
  const q = input.value.trim();
  if (!q) return;
  input.value = '';
  chatHist.push({ role: 'user', text: q });
  renderChat();
  const box = document.getElementById('chat-messages');
  box.innerHTML += '\n<em style="color:var(--text2)">Thinkingâ€¦</em>';
  box.scrollTop = box.scrollHeight;
  try {
    const res = await api('POST', '/analyse', { query: q });
    chatHist.push({ role: 'agent', text: res.response });
  } catch(e) {
    chatHist.push({ role: 'agent', text: 'âš ï¸ Error: ' + e.message });
  }
  renderChat();
}

function renderChat() {
  const box = document.getElementById('chat-messages');
  box.innerHTML = chatHist.map(m =>
    m.role === 'user'
      ? `<div style="color:var(--accent-light); margin:.5rem 0"><strong>You:</strong> ${escHtml(m.text)}</div>`
      : `<div style="margin:.5rem 0"><strong>ğŸ¤– Agent:</strong>\n${escHtml(m.text)}</div>`
  ).join('') || '<em style="color:var(--text2)">No messages yet.</em>';
  box.scrollTop = box.scrollHeight;
}

function escHtml(s) {
  return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

// â”€â”€ Participant Evaluation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function evaluateParticipant() {
  const box = document.getElementById('eval-result');
  box.style.display = 'block';
  box.textContent = 'Evaluatingâ€¦ (this may take a moment)';
  const pid = document.getElementById('eval-participant').value;
  const metric = document.getElementById('eval-metric').value;
  const hours = document.getElementById('eval-hours').value;
  try {
    const res = await api('GET', `/evaluate/${pid}?metric=${metric}&hours=${hours}`);
    box.textContent = res.evaluation;
  } catch(e) {
    box.textContent = 'âš ï¸ Error: ' + e.message;
  }
}

// â”€â”€ Live Feed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let liveLog = [];
function addLogEntry(level, msg) {
  const now = new Date().toLocaleTimeString();
  liveLog.unshift({ ts: now, level, msg });
  if (liveLog.length > 200) liveLog.pop();
  const el = document.getElementById('live-log');
  el.innerHTML = liveLog.map(e => `
    <div class="log-entry">
      <span class="log-ts">${e.ts}</span>
      <span class="log-level-${e.level}">[${e.level.toUpperCase()}]</span> ${escHtml(e.msg)}
    </div>`).join('');
}

// Poll for live updates
async function pollLive() {
  try {
    const health = await api('GET', '/health');
    addLogEntry('info', `Pipeline pending: ${health.pipeline_pending}`);
  } catch {}
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
refreshDashboard();
loadRules();
setInterval(refreshDashboard, 10000);
setInterval(pollLive, 5000);
</script>
</body>
</html>
